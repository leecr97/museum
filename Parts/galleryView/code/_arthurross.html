<!DOCTYPE html>
<html lang="en">

<head>
    <title>Arthur Ross Gallery</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

    <!-- <link href="bootstrap/css/bootstrap.css" rel="stylesheet"> -->

    <style>
        html,
        body {
            width: 100%;
            height: 100%;
        }
        
        body {
            background-color: #ffffff;
            margin: 0;
            overflow: hidden;
            font-family: arial;
            cursor: default;
        }
        
        #blocker {
            position: absolute;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        #instructions {
            width: 100%;
            height: 100%;
            display: -webkit-box;
            display: -moz-box;
            display: box;
            -webkit-box-orient: horizontal;
            -moz-box-orient: horizontal;
            box-orient: horizontal;
            -webkit-box-pack: center;
            -moz-box-pack: center;
            box-pack: center;
            -webkit-box-align: center;
            -moz-box-align: center;
            box-align: center;
            color: #ffffff;
            text-align: center;
            cursor: pointer;
        }

        /* hamburger button stuff */
        .navbar {
            background-color: transparent;
            border-color: #e7e7e7;
            position: fixed;
            right: 0;
            left: 0;
            z-index: 1030;
            border-radius: 0;
            top: 0;
            border-width: 0 0 1px;
            padding-right: 0;
            padding-left: 0;
            max-height: 340px;
        }

        .hamburger {
            display: inline-block;
            cursor: pointer;
        }

        .bar1, .bar2, .bar3 {
            width: 35px;
            height: 5px;
            background-color: #333;
            margin: 6px 0;
            transition: 0.4s;
        }

        /* Rotate first bar */
        .change .bar1 {
            -webkit-transform: rotate(-45deg) translate(-9px, 6px) ;
            transform: rotate(-45deg) translate(-9px, 6px) ;
        }

        /* Fade out the second bar */
        .change .bar2 {
            opacity: 0;
        }

        /* Rotate last bar */
        .change .bar3 {
            -webkit-transform: rotate(45deg) translate(-8px, -8px) ;
            transform: rotate(45deg) translate(-8px, -8px) ;
        }

        .accordionmenu {
          opacity: 0;
          max-height: 0;
          overflow: hidden;
          transition: 0.6s ease-in-out;
        }

        .accordionmenu.show {
          opacity: 1;
          max-height: 500px;
        }

        /* Style the buttons that are used to open and close the accordion panel */
        button.accordion {
            background-color: #eee;
            color: #444;
            cursor: pointer;
            padding: 18px;
            width: 100%;
            text-align: left;
            border: none;
            outline: none;
            transition: 0.4s;
            font-size: 15px;
        }

        /* Add a background color to the button if it is clicked on (add the .active class with JS), and when you move the mouse over it (hover) */
        button.accordion.active, button.accordion:hover {
            background-color: #ddd;
        }

        button.accordion:after {
            content: '\002B'; /* Unicode character for "plus" sign (+) */
            font-size: 13px;
            color: #777;
            font-weight: bold;
            float: right;
            margin-left: 5px;
        }

        button.accordion.active:after {
            content: "\2212"; /* Unicode character for "minus" sign (-) */
        }

        /* Style the accordion panel.*/
        div.panel {
            padding: 0 18px;
            background-color: white;
            max-height: 0px;
            overflow: hidden;
            transition: 0.6s ease-in-out;
            opacity: 0;
            /*display: none;*/
        }

        .panel.show {
          opacity: 1;
          max-height: 500px;
          /*display: inline;*/
        }

        /* The Modal (background) */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0,0,0);
            background-color: rgba(0,0,0,0.4);
        }

        .modal-header {
            padding: 2px 16px;
            background-color: #c48635;
            color: white;
        }

        .modal-body {padding: 2px 16px;}

        .modal-footer {
            padding: 2px 16px;
            background-color: #c48635;
            color: white;
        }

        .modal-content {
            position: relative;
            background-color: #fefefe;
            margin: auto;
            padding: 0;
            border: 1px solid #888;
            width: 80%;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
            -webkit-animation-name: animatetop;
            -webkit-animation-duration: 0.4s;
            animation-name: animatetop;
            animation-duration: 0.4s
        }

        .pic {
          display: inline-block;
          width: 25%;
          height: 100%;
          vertical-align: top;
        }

        .desc {
          display: inline-block;
          width: 70%;
          vertical-align: top;
          margin-left: 5%;
        }

    </style>
</head>

<body>
    <script src="js/jquery.min.js"></script>

    <script src="../build/three.min.js"></script>
    <script src="js/controls/FirstPersonControls.js"></script>

    <script src="js/loaders/DDSLoader.js"></script>
    <script src="js/loaders/MTLLoader.js"></script>
    <script src="js/loaders/OBJLoader.js"></script>

    <script src="js/Detector.js"></script>
    <script src="js/libs/stats.min.js"></script>

    <!-- navbar-default navbar-fixed-top -->
    <div class="navbar">
        <div class="hamburger" onclick="myFunction(this)">
          <div class="bar1"></div>
          <div class="bar2"></div>
          <div class="bar3"></div>
        </div>

        <div class="accordionmenu" id = "dropdown">
            <button class="accordion">Section 1</button>
            <div class="panel">
              <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. </p>
            </div>

            <button class="accordion">Section 2</button>
            <div class="panel">
              <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. </p>
            </div>

            <button class="accordion">Section 3</button>
            <div class="panel">
              <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. </p>
            </div>
        </div>
    </div>

    <!-- <div id="ThreeJS" style="position: absolute; left:0px; top:0px">
    </div> -->

    <div id="modalwindow" class="modal">
      <div class="modal-content">
          <div id="modalheader" class="modal-header">
            <span class="close">&times;</span>
            <!-- FILLED BY SCRIPT DYNAMICALLY-->
          </div>
          <div id="modalcontent" class="modal-body">
            <!-- FILLED BY SCRIPT DYNAMICALLY-->
          </div>
          <div id="modalfooter" class="modal-footer">
            <!-- FILLED BY SCRIPT DYNAMICALLY-->
          </div>
        </div>
    </div>

    <div id="blocker">

        <div id="instructions">
            <span style="font-size:40px">Click to Enter</span>
            <br /> (W, A, S, D = Move)
        </div>

    </div>

    <script>
    function myFunction(x) {
        x.classList.toggle("change");
        document.getElementById("dropdown").classList.toggle("show");
    }

    var acc = document.getElementsByClassName("accordion");
    var i;

    for (i = 0; i < acc.length; i++) {
      acc[i].onclick = function() {
        this.classList.toggle("active");
        var panel = this.nextElementSibling;
        panel.classList.toggle("show");
        if (panel.style.maxHeight){
          panel.style.maxHeight = null;
        } else {
          panel.style.maxHeight = panel.scrollHeight + "px";
        } 
      }
    }
    </script>

    <script>

        var camera, scene, renderer;
        var geometry, material, mesh;
        var controls;
        var container, stats;

        var objects = [];

        var myobjects = [];

        var nodenames = [];

        var raycaster;
        var mouse, INTERSECTED;
        var nameVisible = false;

        var blocker = document.getElementById('blocker');
        var instructions = document.getElementById('instructions');

        var element = document.body;

        function turnOff() {
            controls.enabled = false;
            controlsEnabled = false;

            blocker.style.display = '-webkit-box';
            blocker.style.display = '-moz-box';
            blocker.style.display = 'box';

            instructions.style.display = '';
        }

        instructions.addEventListener('click', function(event) {

            instructions.style.display = 'none';
            controlsEnabled = true;
            controls.enabled = true;

            blocker.style.display = 'none';

        }, false);

        // instructions.style.display = 'none';
        // blocker.style.display = 'none';

        init();
        animate();

        var controlsEnabled = false;
        // controls.enabled = true;

        var moveForward = false;
        var moveBackward = false;
        var moveLeft = false;
        var moveRight = false;
        //var canJump = false;

        var pitchUp = false;
        var pitchDown = false;
        var yawLeft = false;
        var yawRight = false;

        var prevTime = performance.now();
        var velocity = new THREE.Vector3();

        function init() {

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 1000);

            scene = new THREE.Scene();


            // controls = new THREE.PointerLockControls(camera);
            controls = new THREE.FirstPersonControls(camera);
            scene.add(controls.getObject());

            var ambient = new THREE.AmbientLight(0x404040);
            scene.add(ambient);

            var light = new THREE.PointLight( 0xffffff, 1, 100 );
      			light.position.set( 50, 50, 50 );
      			//scene.add( light );
      			light.position.set( 10, 10, 10 );
      			scene.add( light );
           // var directionalLight = new THREE.DirectionalLight(0xffeedd);
            //directionalLight.position.set(0, 0, 1).normalize();
           // scene.add(directionalLight);

           // gambling tray and nice node
           var geometry = new THREE.SphereGeometry( 0.5, 32, 32 );
           var node_gamblingtray = new THREE.Mesh(geometry, new THREE.MeshBasicMaterial({color: "rgb(178, 111, 23)", opacity: 0.5}));
           node_gamblingtray.position.set(20, 6, -60);

           node_gamblingtray.scale.set(1, 1, 1);   

           // node.rotation.x = 90;
           // node.rotation.y = 90;

           node_gamblingtray.name = "gamblingtray";

           scene.add(node_gamblingtray);
           myobjects.push(node_gamblingtray);

           // name of gt node. hidden by default
           var n1label = makeTextSprite("Gambling Tray and Die", {
              fontsize: 24,
              borderColor: {r:178, g:111, b:23, a:1.0},
              backgroundColor: {r:255, g:255, b:255, a:1.0}
           });
           n1label.position.set(-0.5, 2, 0);
           scene.add( n1label );
           nodenames.push(n1label);

           node_gamblingtray.add(n1label);

           n1label.visible = false;

           // koshare node
           var node_koshare = new THREE.Mesh(geometry, new THREE.MeshBasicMaterial({color: "rgb(178, 111, 23)", opacity: 0.5}));
           node_koshare.position.set(16, 6, -77);

           node_koshare.scale.set(1, 1, 1);  

           node_koshare.name = "koshare";

           scene.add(node_koshare);
           myobjects.push(node_koshare);

           // name of koshare node. hidden by default
           var n2label = makeTextSprite("Koshare", {
              fontsize: 24,
              borderColor: {r:178, g:111, b:23, a:1.0},
              backgroundColor: {r:255, g:255, b:255, a:1.0}
           });
           n2label.position.set(4, 2, 0);
           scene.add( n2label );
           nodenames.push(n2label);

           node_koshare.add(n2label);

           n2label.visible = false;


            // firepit node
           var node_firepit = new THREE.Mesh(geometry, new THREE.MeshBasicMaterial({color: "rgb(178, 111, 23)", opacity: 0.5}));
           node_firepit.position.set(0, 4, -38);

           node_firepit.scale.set(1, 1, 1);  

           node_firepit.name = "firepit";

           scene.add(node_firepit);
           myobjects.push(node_firepit);

           // name of firepit node. hidden by default
           var n3label = makeTextSprite("Firepit Video", {
              fontsize: 24,
              borderColor: {r:178, g:111, b:23, a:1.0},
              backgroundColor: {r:255, g:255, b:255, a:1.0}
           });
           n3label.position.set(3, 2, 0);
           scene.add( n3label );
           nodenames.push(n3label);

           node_firepit.add(n3label);

           n3label.visible = false;


           // returning salmon node
           var node_salmon = new THREE.Mesh(geometry, new THREE.MeshBasicMaterial({color: "rgb(178, 111, 23)", opacity: 0.5}));
           node_salmon.position.set(-16, 6, -77);

           node_salmon.scale.set(1, 1, 1);  

           node_salmon.name = "salmon";

           scene.add(node_salmon);
           myobjects.push(node_salmon);

           // name of returning salmon node. hidden by default
           var n4label = makeTextSprite("Returning Salmon", {
              fontsize: 24,
              borderColor: {r:178, g:111, b:23, a:1.0},
              backgroundColor: {r:255, g:255, b:255, a:1.0}
           });
           n4label.position.set(5, 2, 0);
           scene.add( n4label );
           nodenames.push(n4label);

           node_salmon.add(n4label);

           n4label.visible = false;


           // saddlebag node
           var node_saddlebag = new THREE.Mesh(geometry, new THREE.MeshBasicMaterial({color: "rgb(178, 111, 23)", opacity: 0.5}));
           node_saddlebag.position.set(-20, 6, -58);

           node_saddlebag.scale.set(1, 1, 1);  

           node_saddlebag.name = "saddlebag";

           scene.add(node_saddlebag);
           myobjects.push(node_saddlebag);

           // name of saddlebag node. hidden by default
           var n5label = makeTextSprite("Saddlebag", {
              fontsize: 24,
              borderColor: {r:178, g:111, b:23, a:1.0},
              backgroundColor: {r:255, g:255, b:255, a:1.0}
           });
           n5label.position.set(5, 2, 0);
           scene.add( n5label );
           nodenames.push(n5label);

           node_saddlebag.add(n5label);

           n5label.visible = false;

           // nestling worlds node
           var node_nestling = new THREE.Mesh(geometry, new THREE.MeshBasicMaterial({color: "rgb(178, 111, 23)", opacity: 0.5}));
           node_nestling.position.set(-20, 6, -12);

           node_nestling.scale.set(1, 1, 1);  

           node_nestling.name = "nestling";

           scene.add(node_nestling);
           myobjects.push(node_nestling);

           // name of nestling worlds node. hidden by default
           var n6label = makeTextSprite("Nestling Worlds", {
              fontsize: 24,
              borderColor: {r:178, g:111, b:23, a:1.0},
              backgroundColor: {r:255, g:255, b:255, a:1.0}
           });
           n6label.position.set(5, 2, 0);
           scene.add( n6label );
           nodenames.push(n6label);

           node_nestling.add(n6label);

           n6label.visible = false;


           // jingle powwow dress node
           var node_jpdress = new THREE.Mesh(geometry, new THREE.MeshBasicMaterial({color: "rgb(178, 111, 23)", opacity: 0.5}));
           node_jpdress.position.set(-17, 8, 0);

           node_jpdress.scale.set(1, 1, 1);  

           node_jpdress.name = "jpdress";

           scene.add(node_jpdress);
           myobjects.push(node_jpdress);

           // name of jingle powwow dress node. hidden by default
           var n7label = makeTextSprite("Jingle Powwow Dress", {
              fontsize: 24,
              borderColor: {r:178, g:111, b:23, a:1.0},
              backgroundColor: {r:255, g:255, b:255, a:1.0}
           });
           n7label.position.set(4, 2, 0);
           scene.add( n7label );
           nodenames.push(n7label);

           node_jpdress.add(n7label);

           n7label.visible = false;


           // parfleche case node
           var node_parfleche = new THREE.Mesh(geometry, new THREE.MeshBasicMaterial({color: "rgb(178, 111, 23)", opacity: 0.5}));
           node_parfleche.position.set(20, 6, -20);

           node_parfleche.scale.set(1, 1, 1);  

           node_parfleche.name = "parfleche";

           scene.add(node_parfleche);
           myobjects.push(node_parfleche);

           // name of parfleche case node. hidden by default
           var n8label = makeTextSprite("Parfleche Case", {
              fontsize: 24,
              borderColor: {r:178, g:111, b:23, a:1.0},
              backgroundColor: {r:255, g:255, b:255, a:1.0}
           });
           n8label.position.set(1, 2, 0);
           scene.add( n8label );
           nodenames.push(n8label);

           node_parfleche.add(n8label);

           n8label.visible = false;


           // cradleboard node
           var node_cradleboard = new THREE.Mesh(geometry, new THREE.MeshBasicMaterial({color: "rgb(178, 111, 23)", opacity: 0.5}));
           node_cradleboard.position.set(20, 6, -10);

           node_cradleboard.scale.set(1, 1, 1);  

           node_cradleboard.name = "cradleboard";

           scene.add(node_cradleboard);
           myobjects.push(node_cradleboard);

           // name of cradleboard node. hidden by default
           var n9label = makeTextSprite("Cradleboard", {
              fontsize: 24,
              borderColor: {r:178, g:111, b:23, a:1.0},
              backgroundColor: {r:255, g:255, b:255, a:1.0}
           });
           n9label.position.set(1, 2, 0);
           scene.add( n9label );
           nodenames.push(n9label);

           node_cradleboard.add(n9label);

           n9label.visible = false;


           // second room connection
           var nnMap = new THREE.TextureLoader().load("./siglab.png");
           console.log(nnMap);
           nnMap.minFilter = THREE.LinearFilter;
           var nnMaterial = new THREE.SpriteMaterial( { map: nnMap } );
           var transport = new THREE.Sprite( nnMaterial );

           transport.position.set(0, 6, -79);

           // transport.scale.set(2, 2, 1);  

           transport.name = "transport";

           scene.add(transport);
           myobjects.push(transport);


           // second room node name. hidden by default
           var s2label = makeTextSprite("To Sig Lab", {
              fontsize: 24,
              borderColor: {r:11, g:180, b:50, a:1.0},
              backgroundColor: {r:255, g:255, b:255, a:1.0}
           });
           s2label.position.set(3.5, 2, 0);

           scene.add( s2label );

           var container = new THREE.Group();
           transport.add( container );
           container.add( s2label );
           
           transport.scale.x = 10;
           transport.scale.y = 5;
           container.scale.x = 0.1;
           container.scale.y = 0.2;


           // exit block 
           geometry = new THREE.PlaneGeometry( 20, 25, 1, 1 );
           var exitblock = new THREE.Mesh( geometry, new THREE.MeshBasicMaterial({color: "rgb(200, 200, 200)", side: THREE.DoubleSide}) );
           exitblock.position.set(0, 6, -85);
           scene.add(exitblock);


           // entrance block 
           geometry = new THREE.PlaneGeometry( 20, 25, 1, 1 );
           var entrblock = new THREE.Mesh( geometry, new THREE.MeshBasicMaterial({color: "rgb(200, 200, 200)", side: THREE.DoubleSide}) );
           entrblock.position.set(0, 6, 5);
           scene.add(entrblock);


           // ceiling cover  
           geometry = new THREE.PlaneGeometry( 50, 90, 1, 1 );
           var topcover = new THREE.Mesh( geometry, new THREE.MeshBasicMaterial({color: "rgb(200, 200, 200)", side: THREE.DoubleSide}) );
           topcover.position.set(0, 20, -40);
           topcover.rotation.x = Math.PI / 2;

           scene.add(topcover);


           // right side covers
           geometry = new THREE.PlaneGeometry( 8, 90, 1, 1 );
           var rightcover = new THREE.Mesh( geometry, new THREE.MeshBasicMaterial({color: "rgb(200, 200, 200)", side: THREE.DoubleSide}) );
           rightcover.position.set(24, 17.35, -40);
           rightcover.rotation.x = Math.PI / 2;
           rightcover.rotation.y = Math.PI / 2;

           scene.add(rightcover);

           geometry = new THREE.PlaneGeometry( 7, 18, 1, 1 );
           rightcover = new THREE.Mesh( geometry, new THREE.MeshBasicMaterial({color: "rgb(200, 200, 200)", side: THREE.DoubleSide}) );
           rightcover.position.set(25.5, 11.5, -38.5);
           rightcover.rotation.x = Math.PI / 2;
           rightcover.rotation.y = Math.PI / 2;

           scene.add(rightcover);


           // left side cover
           geometry = new THREE.PlaneGeometry( 8, 90, 1, 1 );
           var leftcover = new THREE.Mesh( geometry, new THREE.MeshBasicMaterial({color: "rgb(200, 200, 200)", side: THREE.DoubleSide}) );
           leftcover.position.set(-24, 17.35, -40);
           leftcover.rotation.x = Math.PI / 2;
           leftcover.rotation.y = Math.PI / 2;

           scene.add(leftcover);

           geometry = new THREE.PlaneGeometry( 7, 18, 1, 1 );
           leftcover = new THREE.Mesh( geometry, new THREE.MeshBasicMaterial({color: "rgb(200, 200, 200)", side: THREE.DoubleSide}) );
           leftcover.position.set(-25, 11.5, -38.5);
           leftcover.rotation.x = Math.PI / 2;
           leftcover.rotation.y = Math.PI / 2;

           scene.add(leftcover);
           

           // back cover
           geometry = new THREE.PlaneGeometry( 48, 8, 1, 1 );
           var backcover = new THREE.Mesh( geometry, new THREE.MeshBasicMaterial({color: "rgb(200, 200, 200)", side: THREE.DoubleSide}) );
           backcover.position.set(0, 17.35, -80);

           scene.add(backcover);


           // front cover
           geometry = new THREE.PlaneGeometry( 48, 8, 1, 1 );
           var frontcover = new THREE.Mesh( geometry, new THREE.MeshBasicMaterial({color: "rgb(200, 200, 200)", side: THREE.DoubleSide}) );
           frontcover.position.set(0, 17.35, 0);

           scene.add(frontcover);


            // model
            var onProgress = function(xhr) {
                if (xhr.lengthComputable) {
                    var percentComplete = xhr.loaded / xhr.total * 100;
                    console.log(Math.round(percentComplete, 2) + '% downloaded');
                }
            };
            var onError = function(xhr) {};
            THREE.Loader.Handlers.add(/\.dds$/i, new THREE.DDSLoader());
            var mtlLoader = new THREE.MTLLoader();
            mtlLoader.setBaseUrl('./museum/');
            mtlLoader.setPath('./museum/');
            mtlLoader.load('naexhibit.mtl', function(materials) {
                materials.preload();
                var objLoader = new THREE.OBJLoader();
                objLoader.setMaterials(materials);
                objLoader.setPath('./museum/');
                objLoader.load('naexhibit.obj', function(object) {
                    object.position.set(0,0,0);
                     // object.rotation = new THREE.Vector3(0,0,0);
                    object.rotation.x = -(Math.PI / 2);
                    object.rotation.z = Math.PI / 2;
                    object.scale.x = 5;
                    object.scale.y = 5;
                    object.scale.z = 5;
                   // object.rotation.x = 3.14159;
                    //object.rotation.y = -3.14;
                    //object.rotation.z = 1.5708;
                    //object.position.y = 1;
                    console.log(object);
                    scene.add(object);
                }, onProgress, onError);
            });

            //
            renderer = new THREE.WebGLRenderer();
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            //container.appendChild( renderer.domElement );
            // container = document.getElementById('ThreeJS');
            // container.appendChild( renderer.domElement);


            var onKeyDown = function(event) {

                switch (event.keyCode) {

                    case 38: // up
                        pitchUp = true;
                        break;

                    case 87: // w
                        moveForward = true;
                        break;

                    case 37: // left
                        yawLeft = true;
                        break;

                    case 65: // a
                        moveLeft = true;
                        break;

                    case 40: // down
                        pitchDown = true;
                        break;

                    case 83: // s
                        moveBackward = true;
                        break;

                    case 39: // right
                        yawRight = true;
                        break;

                    case 68: // d
                        moveRight = true;
                        break;

                    case 32: // space
                        resetPos();
                        break;

                    case 27: // esc
                        turnOff();
                        break;

                }

            };

            var onKeyUp = function(event) {

                switch (event.keyCode) {

                    case 38: // up
                        pitchUp = false;
                        break;

                    case 87: // w
                        moveForward = false;
                        break;

                    case 37: // left
                        yawLeft = false;
                        break;

                    case 65: // a
                        moveLeft = false;
                        break;

                    case 40: // down
                        pitchDown = false;
                        break;

                    case 83: // s
                        moveBackward = false;
                        break;

                    case 39: // right
                        yawRight = false;
                        break;

                    case 68: // d
                        moveRight = false;
                        break;

                }

            };

            document.addEventListener('keydown', onKeyDown, false);
            document.addEventListener('keyup', onKeyUp, false);

            // raycaster = new THREE.Raycaster(new THREE.Vector3(), new THREE.Vector3(0, -1, 0), 0, 10);

            raycaster = new THREE.Raycaster();

            mouse = new THREE.Vector2();

            document.addEventListener('mousedown', onDocumentMouseDown, false);
            document.addEventListener('touchstart', onDocumentTouchStart, false);
            document.addEventListener('mousemove', onDocumentMouseMove, false);

           


            //

            renderer = new THREE.WebGLRenderer();
            renderer.setClearColor(0xffffff);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);
            // stats = new Stats();
            // stats.domElement.style.position = 'absolute';
            // stats.domElement.style.bottom = '0px';
            // stats.domElement.style.zIndex = 100;
            // container.appendChild( stats.domElement );

            //

            window.addEventListener('resize', onWindowResize, false);

        }

        function makeTextSprite( message, parameters )
        {
          if ( parameters === undefined ) parameters = {};
          
          var fontface = parameters.hasOwnProperty("fontface") ? 
            parameters["fontface"] : "Arial";
          
          var fontsize = parameters.hasOwnProperty("fontsize") ? 
            parameters["fontsize"] : 18;
          
          var borderThickness = parameters.hasOwnProperty("borderThickness") ? 
            parameters["borderThickness"] : 4;
          
          var borderColor = parameters.hasOwnProperty("borderColor") ?
            parameters["borderColor"] : { r:0, g:0, b:0, a:1.0 };
          
          var backgroundColor = parameters.hasOwnProperty("backgroundColor") ?
            parameters["backgroundColor"] : { r:255, g:255, b:255, a:1.0 };
            
          var canvas = document.createElement('canvas');
          // document.body.appendChild(canvas);
          var context = canvas.getContext('2d');
          context.font = "Bold " + fontsize + "px " + fontface;
            
          // get size data (height depends only on font size)
          var metrics = context.measureText( message );
          var textWidth = metrics.width;

          // background color
          context.fillStyle   = "rgba(" + backgroundColor.r + "," + backgroundColor.g + ","
                          + backgroundColor.b + "," + backgroundColor.a + ")";
          // border color
          context.strokeStyle = "rgba(" + borderColor.r + "," + borderColor.g + ","
                          + borderColor.b + "," + borderColor.a + ")";

          context.lineWidth = borderThickness;
          roundRect(context, borderThickness/2, borderThickness/2, textWidth + borderThickness, fontsize * 1.4 + borderThickness, 6);
          // 1.4 is extra height factor for text below baseline: g,j,p,q.
          
          // text color
          context.fillStyle = "rgba(0, 0, 0, 1.0)";

          context.fillText( message, borderThickness, fontsize + borderThickness);
          
          // canvas contents will be used for a texture
          var texture = new THREE.Texture(canvas) 
          texture.needsUpdate = true;

          var spriteMaterial = new THREE.SpriteMaterial( 
            { map: texture } );
          var sprite = new THREE.Sprite( spriteMaterial );
          sprite.scale.set(0.5 * fontsize, 0.25 * fontsize, 1);
          return sprite;  
        }

        // function for drawing rounded rectangles
        function roundRect(ctx, x, y, w, h, r) 
        {
            ctx.beginPath();
            ctx.moveTo(x+r, y);
            ctx.lineTo(x+w-r, y);
            ctx.quadraticCurveTo(x+w, y, x+w, y+r);
            ctx.lineTo(x+w, y+h-r);
            ctx.quadraticCurveTo(x+w, y+h, x+w-r, y+h);
            ctx.lineTo(x+r, y+h);
            ctx.quadraticCurveTo(x, y+h, x, y+h-r);
            ctx.lineTo(x, y+r);
            ctx.quadraticCurveTo(x, y, x+r, y);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();   
        }

        function onDocumentTouchStart(event) {
            event.preventDefault();
            event.clientX = event.touches[0].clientX;
            event.clientY = event.touches[0].clientY;
            onDocumentMouseDown(event);
        }

        // Get the modal
        var modal = document.getElementById('modalwindow');

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];

        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
            modal.style.display = "none";
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        var mheader = document.getElementById("modalheader");
        var mcontent = document.getElementById("modalcontent");
        var mfooter = document.getElementById("modalfooter");

        function onDocumentMouseDown(event) {
            event.preventDefault();
            mouse.x = ( event.clientX / renderer.domElement.clientWidth ) * 2 - 1;
            mouse.y = - ( event.clientY / renderer.domElement.clientHeight ) * 2 + 1;

            raycaster.setFromCamera( mouse, camera );
            var intersects = raycaster.intersectObjects( myobjects );
            if ( intersects.length > 0 ) {

                var chosen = intersects[0].object;

                if (controlsEnabled) {
                  if (chosen.name == "firepit") {
                    mheader.innerHTML = "<h2> Firepit Video </h2>";
                    mcontent.innerHTML = "";
                    var videolink = document.createElement('iframe');
                    videolink.width = 560;
                    videolink.height = 315;
                    videolink.src = "https://www.youtube.com/embed/MnMS44xjbcw";
                    mcontent.appendChild(videolink);
                    mfooter.innerHTML = "<h3> Firepit footer </h3>";

                    modal.style.display = "block";
                  }
                  else if (chosen.name == "gamblingtray") {
                    mheader.innerHTML = "<h2> Gambling Tray and Dice </h2> <i>Redbud Sage, Sedge, Bracken Fern, Abalone Shell, Walnut Shell, and Beeswax</i> <br> ca. 1890";

                    mcontent.innerHTML = "";

                    var div = document.createElement('div');

                    var pic  = document.createElement('img');
                    pic.src = "./images/placeholder.png";
                    pic.width = 200;
                    pic.className = "pic";
                    div.appendChild(pic);

                    var desc = document.createElement('p');
                    desc.innerHTML = "Yokuts women played a game using trays and dice, like those here. The game, played by two teams of two, involved throwing the dice, called hoo'utch, onto the tral, called tiwon. Depending on how the dice landed, money changed hands. Such games were played at social gatherings, including funerals, where it was important to give thanks to community members.";
                    desc.className = "desc";
                    div.appendChild(desc);

                    mcontent.appendChild(div);

                    mfooter.innerHTML = "<b>Culture: </b> Yokuts <br> <b>Location: </b> United States, Central California";

                    modal.style.display = "block";
                  }
                  else if (chosen.name == "koshare") {
                    mheader.innerHTML = "<h2> Koshare </h2> <i>Wood, Acrylic Paint, and Raffie</i> <br> ca. 1985";

                    mcontent.innerHTML = "";

                    var div = document.createElement('div');

                    var pic  = document.createElement('img');
                    pic.src = "./images/placeholder.png";
                    pic.width = 200;
                    pic.className = "pic";
                    div.appendChild(pic);

                    var desc = document.createElement('p');
                    desc.innerHTML = "A <i>koshare</i> is a <i>katsina</i>, one of many Pueblo spirit beings. Koshares are clowns who represent balance in life. The Hopi of northern Arizona honor <i>katsinas</i> with ceremonies and dances. The katsina spirits live in the nearby San Francisco Peaks. They brings gifts of life and health, such as watermelons, to the people.";
                    desc.className = "desc";
                    div.appendChild(desc);

                    mcontent.appendChild(div);

                    mfooter.innerHTML = "<b>Made By: </b> F. Healing <br> <b>Culture: </b> Pueblo, Hopi <br> <b>Location: </b> United States, Arizona";

                    modal.style.display = "block";
                  }
                  else if (chosen.name == "salmon") {
                    mheader.innerHTML = "<h2> Returning Salmon </h2> <i>Glass and Wood</i> <br> 1994";

                    mcontent.innerHTML = "";

                    var div = document.createElement('div');

                    var pic  = document.createElement('img');
                    pic.src = "./images/placeholder.png";
                    pic.width = 200;
                    pic.className = "pic";
                    div.appendChild(pic);

                    var desc = document.createElement('p');
                    desc.innerHTML = "This glass sculpture incorporating a salmon motif represents a Musqueam spindle whorl, an ancient hand tool used by ancestors to spin wool into yarn. Canadian artist Susan Point uses it here as a symbol of community. Named one of British Columbia's 100 most influential women and awarded a lifetime membership to the Royal Canadian Academy of Arts, Point draws inspiration from her ancestors while employing non-traditional techniques to create her art.";
                    desc.className = "desc";
                    div.appendChild(desc);

                    mcontent.appendChild(div);

                    mfooter.innerHTML = "<b>Made By: </b> Susan Point <br> <b>Culture: </b> Musqueam <br> <b>Location: </b> Canada, British Columbia, Musquean First Nation";

                    modal.style.display = "block";
                  }
                  else if (chosen.name == "saddlebag") {
                    mheader.innerHTML = "<h2> Saddlebag </h2> <i>Buffalo Hide, Beads, Tin, and Porcupine Quill</i> <br> ca. 1840";

                    mcontent.innerHTML = "";

                    var div = document.createElement('div');

                    var pic  = document.createElement('img');
                    pic.src = "./images/placeholder.png";
                    pic.width = 200;
                    pic.className = "pic";
                    div.appendChild(pic);

                    var desc = document.createElement('p');
                    desc.innerHTML = "This saddlebag was recycled from an old parfleche or rawhide bag. The black-and-white, beaded design suggests eagle feathers, which are sacret to the Cheyenne. In the 1800s, the US government relocated the Cheyenne to Oklahoma, though some resisted. Today, the Cheyenne are split between two federally recognized s in Montana and Oklahoma.";
                    desc.className = "desc";
                    div.appendChild(desc);

                    mcontent.appendChild(div);

                    mfooter.innerHTML = "<b>Culture: </b> Tsistsistas (Cheyenne) <br> <b>Location: </b> United States, Central Plains";

                    modal.style.display = "block";
                  }
                  else if (chosen.name == "nestling") {
                    mheader.innerHTML = "<h2> Nestling Worlds </h2> <i>Clay</i>";

                    mcontent.innerHTML = "";

                    var div = document.createElement('div');

                    var pic  = document.createElement('img');
                    pic.src = "./images/placeholder.png";
                    pic.width = 200;
                    pic.className = "pic";
                    div.appendChild(pic);

                    var desc = document.createElement('p');
                    desc.innerHTML = "Pueblo sculptor Roxanne Swentzell created this piece after watching a forest fire approach her New Mexico home. It represents her view of the world as layered entities (bowls) held and protected by Mother Earth. Swentzell has gained international recognition as an artist. World renowned, she maintains her studios at Santa Clara and gives back to her Pueblo community.";
                    desc.className = "desc";
                    div.appendChild(desc);

                    mcontent.appendChild(div);

                    mfooter.innerHTML = "<b>Made By: </b> Roxanne Swentzell (1962 - ) <br> <b>Culture: </b> Pueblo, Santa Clara <br> <b>Location: </b> United States, New Mexico, Santa Clara Pueblo";

                    modal.style.display = "block";
                  }
                  else if (chosen.name == "jpdress") {
                    mheader.innerHTML = "<h2> Jingle Powwow Dress </h2> <i>Polyester, Cotton, Metal, Cowhide</i> <br> 2013";

                    mcontent.innerHTML = "";

                    var div = document.createElement('div');

                    var pic  = document.createElement('img');
                    pic.src = "./images/placeholder.png";
                    pic.width = 200;
                    pic.className = "pic";
                    div.appendChild(pic);

                    var desc = document.createElement('p');
                    desc.innerHTML = "This contemporary &quot;jingle dress&quot; was commissioned for the exhibition by Otoe-Missouria artists Janet and James Littlecrow. The original Ojibwe dress of this style was made as a prayer and worn by a young girl in a healing dance. Its decorative cones are made from rolled metal snuff-tobanno can lids and &quot;jingle&quot; when they are danced. Today, girls often dance this style as a blessing for an individual family member or for the entire Native community.";
                    desc.className = "desc";
                    div.appendChild(desc);

                    mcontent.appendChild(div);

                    mfooter.innerHTML = "<b>Made By: </b> Janet and James Littlecrow <br> <b>Culture: </b> Otoe-Missouria <br> <b>Location: </b> United States, Oklahoma, Ponca";

                    modal.style.display = "block";
                  }
                  else if (chosen.name == "parfleche") {
                    mheader.innerHTML = "<h2> Parfleche Case </h2> <i>Rawhide, Buckskin, and Pigment</i> <br> ca. 1890";

                    mcontent.innerHTML = "";

                    var div = document.createElement('div');

                    var pic  = document.createElement('img');
                    pic.src = "./images/placeholder.png";
                    pic.width = 200;
                    pic.className = "pic";
                    div.appendChild(pic);

                    var desc = document.createElement('p');
                    desc.innerHTML = "This Shoshoni parfleche or rawhide case was used to hold a war bonnet. Today's Eastern Shoshoni Tribe shares the Wind River in Wyoming with the Northern Arapaho Tribe. These federally allotted lands bear the distinction of being the only ones chosen by the tribes themselves. They include the traditional Shoshoni homeland.";
                    desc.className = "desc";
                    div.appendChild(desc);

                    mcontent.appendChild(div);

                    mfooter.innerHTML = "<b>Culture: </b> Shoshoni <br> <b>Location: </b> United States, Wyoming, Wind River Agency";

                    modal.style.display = "block";
                  }
                  else if (chosen.name == "cradleboard") {
                    mheader.innerHTML = "<h2> Cradleboard </h2> <i>Buckskin, Glass Bead, Wood, and Cotton</i> <br> ca. 1875";

                    mcontent.innerHTML = "";

                    var div = document.createElement('div');

                    var pic  = document.createElement('img');
                    pic.src = "./images/placeholder.png";
                    pic.width = 200;
                    pic.className = "pic";
                    div.appendChild(pic);

                    var desc = document.createElement('p');
                    desc.innerHTML = "For centuries, Native American women have used cradleboards, like this beaded example, to protect and swaddle their infants. They allowed mothers to securely hold their babies while working or traveling. Recently, the use of cradleboards, which keeps a child on his or her back, has been endorsed to help reduce the risk of SIDS (Sudden Infant Death Syndrome). Many Native families use cradleboards today.";
                    desc.className = "desc";
                    div.appendChild(desc);

                    mcontent.appendChild(div);

                    mfooter.innerHTML = "<b>Culture: </b> Gaigwa (Kiowa) <br> <b>Location: </b> United States, Oklahoma";

                    modal.style.display = "block";
                  }
                  else if (chosen.name == "transport") {
                    var pos = controls.getObject().position;
                    var dist = pos.distanceTo(chosen.position);
                    console.log(dist);
                    if (dist < 20) {
                      window.location = './_siglab.html';
                    }
                  }
                }
            }
        }

        function onDocumentMouseMove(event) {
            event.preventDefault();
            mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
            mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;
        }

        function onWindowResize() {

            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            renderer.setSize(window.innerWidth, window.innerHeight);

        }

        function resetPos() {
          controls.getObject().position.set(0,0,0);
        }

        function animate() {

            requestAnimationFrame(animate);

            if (controlsEnabled) {
                raycaster.ray.origin.copy(controls.getObject().position);
                raycaster.ray.origin.y -= 10;

                var intersections = raycaster.intersectObjects(objects);

                var isOnObject = intersections.length > 0;

                var time = performance.now();
                var delta = (time - prevTime) / 1000;

                velocity.x -= velocity.x * 10.0 * delta;
                velocity.z -= velocity.z * 10.0 * delta;

                velocity.y -= velocity.y * 10.0 * delta;
                //velocity.y -= 9.8 * 100.0 * delta; // 100.0 = mass

                if (moveForward) velocity.z -= 400.0 * delta;
                if (moveBackward) velocity.z += 400.0 * delta;

                if (moveLeft) velocity.x -= 400.0 * delta;
                if (moveRight) velocity.x += 400.0 * delta;

                if (isOnObject === true) {
                    velocity.y = Math.max(0, velocity.y);

                    //canJump = true;
                }

                controls.getObject().translateX(velocity.x * delta);
                controls.getObject().translateY(velocity.y * delta);
                controls.getObject().translateZ(velocity.z * delta);

                if (controls.getObject().position.y < 5) {

                    velocity.y = 0;
                    controls.getObject().position.y = 5;

                    //canJump = true;

                }

                var PI_2 = Math.PI / 2;

                // if (pitchUp) {
                //     controls.getObject().rotation.x += 0.01;
                //     controls.getObject().rotation.x = Math.max( - PI_2, Math.min( PI_2, controls.getObject().rotation.x ) );
                // }
                // if (pitchDown) {
                //     controls.getObject().rotation.x -= 0.01;
                //     controls.getObject().rotation.x = Math.max( - PI_2, Math.min( PI_2, controls.getObject().rotation.x ) );
                // }

                if (yawLeft) {
                    controls.getObject().rotation.y += 0.01;
                }
                if (yawRight) {
                    controls.getObject().rotation.y -= 0.01;
                }

                prevTime = time;

            }

            render();

        }

        function render() {
            raycaster.setFromCamera( mouse, camera );
            var intersects = raycaster.intersectObjects( myobjects );
            if ( intersects.length > 0 ) {
                if ( INTERSECTED != intersects[ 0 ].object ) {
                    if ( INTERSECTED ) {
                        INTERSECTED.material.color.setHex( INTERSECTED.currentHex );

                        if (nameVisible) {
                            for (var i = 0; i < nodenames.length; i++) {
                                nodenames[i].visible = false;
                            }
                        }
                    }
                    INTERSECTED = intersects[ 0 ].object;
                    INTERSECTED.currentHex = INTERSECTED.material.color.getHex();
                    if (INTERSECTED.name != "transport") {
                      INTERSECTED.material.color.setHex( 0xff0000 );
                    }
                    // 
                    document.body.style.cursor = "pointer";

                    INTERSECTED.traverse( function(child) {
                        child.visible = true;
                        nameVisible = true;
                    });

                }
            } else {
                if ( INTERSECTED ) INTERSECTED.material.color.setHex( INTERSECTED.currentHex );
                INTERSECTED = null;
                
                if (nameVisible) {
                    for (var i = 0; i < nodenames.length; i++) {
                        nodenames[i].visible = false;
                    }
                }
                document.body.style.cursor = "default";
            }
            renderer.render( scene, camera );
        }

        
    </script>


</body>

</html>